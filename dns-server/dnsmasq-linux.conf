# dnsmasq配置文件 - Linux DNS服务器
# 配置文件路径: /etc/dnsmasq.conf
# 用于PT站域名解析

# =================================
# 基本网络设置
# =================================

# DNS端口
port=53

# 监听所有接口
interface=eth0
# 如果有多个网卡，可以指定具体接口：
# interface=ens33
# interface=enp0s3

# 绑定到指定接口
bind-interfaces

# 不提供DHCP服务（仅DNS）
no-dhcp-interface=eth0

# =================================
# 上游DNS服务器
# =================================

# 国内DNS服务器（优先使用）
server=223.5.5.5        # 阿里云DNS
server=223.6.6.6        # 阿里云DNS备用
server=119.29.29.29     # 腾讯DNS
server=114.114.114.114  # 114DNS

# 国外DNS服务器（备用）
server=8.8.8.8          # Google DNS
server=1.1.1.1          # Cloudflare DNS

# 禁用系统resolv.conf文件（我们手动指定上游DNS）
no-resolv

# =================================
# PT站域名解析配置
# =================================

# 主域名解析（修改为Windows PT站服务器的IP地址）
address=/pt.local/192.168.1.100

# 子域名解析（可选配置）
address=/www.pt.local/192.168.1.100
address=/tracker.pt.local/192.168.1.100
address=/api.pt.local/192.168.1.100
address=/admin.pt.local/192.168.1.100

# 泛域名解析（所有*.pt.local子域名）
address=/.pt.local/192.168.1.100

# =================================
# 缓存和性能优化
# =================================

# DNS缓存大小（条目数，建议1000-5000）
cache-size=3000

# 禁用负缓存（避免缓存查询失败）
no-negcache

# 设置上游DNS查询超时时间（秒）
dns-forward-max=150

# 严格按序查询上游DNS服务器
strict-order

# 启用异步日志
log-async=50

# =================================
# 安全配置
# =================================

# 不转发RFC1918私有地址的反向查询
bogus-priv

# 不转发格式错误的域名查询
domain-needed

# 不读取/etc/hosts文件（避免冲突）
no-hosts

# 过滤查询类型（可选，提高安全性）
# 只允许A、AAAA、PTR查询类型
# filterwin2k

# =================================
# 日志配置
# =================================

# 启用查询日志（生产环境可关闭以提高性能）
log-queries

# 日志输出位置（syslog）
# 日志会输出到 /var/log/syslog 或 /var/log/messages

# 启用DHCP日志（虽然不提供DHCP服务）
# log-dhcp

# =================================
# 高级设置
# =================================

# 本地域名后缀
domain=pt.local

# 扩展主机名（添加域名后缀）
expand-hosts

# 本地域名TTL（秒）
local-ttl=600

# 权威记录TTL（秒）
auth-ttl=600

# 设置最大并发DNS查询数
dns-forward-max=150

# =================================
# 监听配置
# =================================

# 仅监听指定的IP地址（可选）
# listen-address=127.0.0.1
# listen-address=192.168.1.200

# 不监听回环地址（如果有特殊需求）
# except-interface=lo

# =================================
# EDNS配置（现代DNS特性）
# =================================

# 启用EDNS支持
edns-packet-max=4096

# =================================
# 条件转发（可选）
# =================================

# 如果有企业内部域名需要转发到特定DNS服务器
# server=/company.local/192.168.2.1
# server=/internal.domain/10.0.1.1
